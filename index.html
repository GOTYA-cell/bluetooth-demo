<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wi-Fi Credentials</title>
</head>
<body>
    <h1>Send Wi-Fi Credentials to ESP32</h1>
    <form id="wifiForm">
        <label for="ssid">SSID:</label><br>
        <input type="text" id="ssid" name="ssid" required><br><br>
        <label for="password">Password:</label><br>
        <input type="password" id="password" name="password" required><br><br>
        <button type="submit">Send Credentials</button>
    </form>

    <p id="status"></p>

    <script>
        let bluetoothDevice;
        let writer;

        document.getElementById("wifiForm").onsubmit = async (e) => {
            e.preventDefault(); // Prevent form submission

            const ssid = document.getElementById("ssid").value;
            const password = document.getElementById("password").value;
            const credentials = ${ssid},${password}\n;

            try {
                if (!bluetoothDevice) {
                    bluetoothDevice = await navigator.bluetooth.requestDevice({
                        acceptAllDevices: true,
                        optionalServices: ['00001101-0000-1000-8000-00805f9b34fb'] // Serial port service UUID
                    });
                    const server = await bluetoothDevice.gatt.connect();
                    const service = await server.getPrimaryService('00001101-0000-1000-8000-00805f9b34fb');
                    const characteristic = await service.getCharacteristic('00001101-0000-1000-8000-00805f9b34fb');
                    writer = characteristic.writeValue.bind(characteristic);
                }
                await writer(new TextEncoder().encode(credentials));
                document.getElementById("status").innerText = "Credentials sent successfully!";
            } catch (error) {
                document.getElementById("status").innerText = "Error: " + error.message;
            }
        };
    </script>
</body>
</html>
